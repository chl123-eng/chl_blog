---
title: 小程序分包
date: 2024-05-10 15:08:26
tags:
  - 小程序
cover:
categories:
  - 总结
feature: true
---

### 前言

微信小程序分包常用于代码量较大的小程序，发布时会受到大小限制

![](https://chlblog.oss-cn-guangzhou.aliyuncs.com/fenbao1.png)

### 什么是分包

分包指的是把一个完整的小程序项目，按照需求划分为不同的子包，在构建时打包成不同的分包，用户在使用时按需进行加载

### 分包的好处

可以优化小程序首次启动的下载时间
在多团队共同开发时可以更好的解耦协作

### 操作方式

#### 1、建立分包文件夹

在项目根目录下创建
分包文件夹 pageA、pageB： 只包含和当前分包有关的页面和私有资源；
pages 主包：一般只包含项目的启动页面或 TabBar 页面、以及所有分包都需要用到的一些公共资源。

![](https://chlblog.oss-cn-guangzhou.aliyuncs.com/fenbao2.png)

#### 2、文件配置

![](https://chlblog.oss-cn-guangzhou.aliyuncs.com/fenbao3.png)

### 打包原则

① 小程序会按 subpackages 的配置进行分包，subpackages 之外的目录将被打包到主包中
② 主包也可以有自己的 pages（(即最外层的 pages 字段)
③tabBar 页面必须在主包内
④ 分包之间不能互相嵌套

### 引用原则

① 主包无法引用分包内的私有资源
② 分包之间不能相互引用私有资源
③ 分包可以引用主包内的公共资源

### 分包–独立分包

#### 1.什么是独立分包

独立分包本质上也是分包，只不过它比较特殊，可以独立于主包和其他分包而单独运行。

#### 2、独立分包和普通分包的区别

·普通分包必须依赖于主包才能运行
·独立分包可以在不下载主包的情况下，独立运行

#### 3、独立分包的应用场景

开发者可以按需，将某些具有一定功能独立性的页面配置到独立分包中。原因如下:
当小程序从普通的分包页面启动时，需要首先下载主包
而独立分包不依赖主包即可运行，可以很大程度上提升分包页面的启动速度
注意:一个小程序中可以有多个独立分包。

#### 4、独立分包的配置方法

```
"independent": true
```

#### 5、引用原则

① 主包无法引用独立分包内的私有资源
② 独立分包之间，不能相互引用私有资源
③ 独立分包和普通分包之间，不能相互引用私有资源
**④ 特别注意:**独立分包中不能引用主包内的公共资源

#### 分包–分包预下载

##### 1.什么是分包预下载

分包预下载指的是:在进入小程序的某个页面时，由框架自动预下载可能需要的分包，从而提升进入后续分包页面时的启动速度。

##### 2.配置分包的预下载

预下载分包的行为，会在进入指定的页面时触发。在 app.json 中，使用 preloadRule 节点定义分包的预下载规则，示例代码如下:

```
  "preloadRule": {//分包预下载规则
    "pages/contact/contact":{//触发分包预下载的页面路径
    	//packages表示进入页面后，预下载哪些分包
    	//可以通过root或name指定预下载哪些分包
      "packages": ["p1"],
      //network表示在指定的网络模式下进行预下载，
	 //可选值为: all（不限网络）和 wifi（仅wifi模式下进行预下载）
	//默认值为: wifi
      "network": "wifi"
    }
  },

```
